node('Docker Host') {
  def job = 'Build_Spring-Boot_APP_Docker-Gradle-Image'
  def art = 'gs-spring-boot-0.1.0.jar'
  stage('Preparation (Checking out)') {
    git branch: "akonchyts_docker2", url: 'https://github.com/akonchyts/docker.git'
  }
  stage('Triggering job and fetching artifact') {
    build job: "${job}"
    step ([$class: 'CopyArtifact',
          projectName: "${job}",
          filter: "${art}"]);
    sh 'pwd'
    sh "mv ${art} docker-2/"
  }
  stage ('Deploy application'){
    sh 'docker-compose -f docker-2/docker-compose.yml up -d'
  }
  stage ('Check application'){
    sh 'sleep 10'
    sh 'curl http://localhost:8081'
    sh 'docker-compose -f docker-2/docker-compose.yml stop'
    sh 'docker-compose -f docker-2/docker-compose.yml rm -f deploy'
  }
}
