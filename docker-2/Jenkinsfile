node('epbyminw3088.minsk.epam.com'){

stage('Git checkout') {
  sh 'rm -rf ./*'
  git branch: 'artsiom_aksionkin-2', url: 'https://github.com/artem-aksenkin/docker.git'
  sh 'cp -r docker-2/initial/ ./'
}

stage ('Building docker gradle image'){
	  docker.build ('jenkins/gradle:1.0', '-f docker-2/gradle.Dockerfile .')
}

stage('Building spring-boot app') {
    docker.image('jenkins/gradle:1.0').inside {
      sh 'gradle -b initial/build.gradle build'
}
}

stage('Deploying app') {
   sh 'docker-compose up -d'
}

stage('Check') {
  sh 'sleep 10 && curl -LI http://127.0.0.1:8081'
  sh 'docker-compose stop'
}
}