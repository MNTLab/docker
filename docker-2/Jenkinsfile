node('docker_host') {
  stage('Checkout') {
    git branch: "marija_demenkova2", url: 'https://github.com/marijademenkova/docker.git'
  }

  stage ('Building gradle.Dockerfile'){
    docker.build('gradle', '-f docker-2/gradle.Dockerfile .')
  }

  stage('Building') {
    docker.image('gradle').inside {
      sh 'gradle -b docker-2/initial/gradlew build'
    }
  }

  stage ('Deploying') {
    sh 'docker-compose up -d'
  }

  stage ('Check') {
    sh 'sleep 10 && curl -IL http://127.0.0.1:8081/'
  }
}
