node('docker') {
    stage ('Building image'){
	git branch: 'nikita_dolya_day2', url: 'https://github.com/bubalush/docker.git'
    def gradle = docker.build ('gradle', '-f docker-2/gradle.Dockerfile .')
}
    stage ('Build app'){
    dir('docker-2'){
        docker.image('gradle:latest').inside {
             sh 'gradle build'
    	    }
	        }
	     }
	stage ('Deploy jar'){

	        sh 'pwd'
	         sh 'mv docker-2/docker-compose.yml ./'
             sh 'mv docker-2/jar.Dockerfile ./'
            sh 'docker-compose up -d'

	}
	stage ('Test jar'){
            sh 'curl  -s -IL http://127.0.0.1:8081 | grep "200"'
    	}
	
}