node('docker') {

 stage('Preparation (Checking out)') {
       git branch: 'nikita_dolya_day2', url: 'https://github.com/bubalush/docker.git'
         }

 stage ('Building docker gradle image'){
	  docker.build ('gradle', '-f docker-2/gradle.Dockerfile .')
            }
 dir('docker-2'){
    stage ('Building code'){
        docker.image('gradle:latest').inside {
             sh 'gradle build'
    	    }
	       }

	stage ('Deployment'){
       	        sh 'docker-compose up -d'
	            }

	stage ('Check'){
	   try {
	         def command = "(curl -o /dev/null --silent --head --write-out '%{http_code}' "http://127.0.0.1:8085")"
	         def urlstatus = command.execute()

	         } catch (error) {

             } finally {
              sh 'docker-compose stop jar && docker-compose rm -f jar'
             }

	        }

	stage ('Sending status') {

         if ({$urlstatus} != 200){
          print ('Unsuccess result'+'Response code= '+ {$urlstatus})
         } else{
           print ('ALL STEPS SUCCESS')
         }
         }
    }
    }
